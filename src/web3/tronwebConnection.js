// src/web3/tronWebConnection.js
import TronWeb from 'tronweb';

const fullNode = 'https://api.shasta.trongrid.io';
const solidityNode = 'https://api.shasta.trongrid.io';
const eventServer = 'https://api.shasta.trongrid.io';

// Coloque sua privateKey se quiser enviar transações sem tronlink
const privateKey = '';

export const tronWeb = new TronWeb(fullNode, solidityNode, eventServer, privateKey);

const CONTRACT_ADDRESS = 'TFqynJsLEfjVXRiYiHF2dWeuf3PB48Cavw';

const CONTRACT_ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "candidatos",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"name": "eleitores",
		"outputs": [
			{
				"internalType": "bool",
				"name": "votou",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getCandidatos",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hashIdentificador",
				"type": "bytes32"
			}
		],
		"name": "jaVotou",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "nomeCandidato",
				"type": "string"
			}
		],
		"name": "totalVotos",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hashIdentificador",
				"type": "bytes32"
			},
			{
				"internalType": "string",
				"name": "nomeCandidato",
				"type": "string"
			}
		],
		"name": "votar",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "votosPorCandidato",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

let contractInstance = null;

export async function getContract() {
  if (!contractInstance) {
    contractInstance = await tronWeb.contract(CONTRACT_ABI, CONTRACT_ADDRESS);
  }
  return contractInstance;
}
